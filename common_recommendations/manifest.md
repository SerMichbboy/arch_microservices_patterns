

General Data:

---

| Категория                          | Паттерн                               | Описание                                                               | Преимущества                                                      | Недостатки                                                     |
| ---------------------------------- | ------------------------------------- | ---------------------------------------------------------------------- | ----------------------------------------------------------------- | -------------------------------------------------------------- |
| **Композиция сервисов**            | API Gateway                           | Все запросы идут через один входной сервис                             | Централизованная маршрутизация, аутентификация, кэширование       | Точка отказа, нужна высокая доступность                        |
|                                    | Backend for Frontend (BFF)            | Разные шлюзы под разные клиенты (веб, мобильные)                       | Оптимизация ответов под конкретное приложение                     | Дополнительная поддержка нескольких шлюзов                     |
| **Взаимодействие между сервисами** | Синхронное (HTTP/REST, gRPC)          | Сервисы напрямую вызывают друг друга                                   | Просто отлаживать, понятно поведение                              | Повышенная связность, сбой одного сервиса влияет на другие     |
|                                    | Асинхронное (Messaging, Event-driven) | Используются брокеры (Kafka, RabbitMQ), публикация/подписка на события | Слабая связность, проще масштабировать                            | Сложнее отслеживать последовательность, консистентность данных |
| **Оркестрация vs Хореография**     | Оркестрация                           | Центральный сервис управляет всеми шагами бизнес-процесса              | Удобно управлять процессом                                        | Центральное узкое место                                        |
|                                    | Хореография                           | Каждый сервис реагирует на события самостоятельно                      | Нет центрального узкого места, подходит для распределённых систем | Сложнее отлаживать цепочки событий                             |
| **Управление данными**             | Database per Service                  | Каждый сервис имеет свою БД                                            | Изоляция, независимое масштабирование                             | Сложнее обеспечить транзакционную согласованность              |
|                                    | Saga Pattern                          | Последовательность локальных транзакций с компенсацией                 | Обработка ошибок и откат шагов                                    | Сложность реализации, отслеживания                             |
| **Сопровождение и надежность**     | Circuit Breaker                       | Разрывает связь с падающим сервисом на время                           | Защищает систему от каскадных сбоев                               | Настройка порогов и мониторинга                                |
|                                    | Retry / Timeout                       | Автоматические повторы при сбоях                                       | Повышает надежность                                               | Возможны задержки и повторные нагрузки                         |
|                                    | Bulkhead                              | Изоляция ресурсов сервисов                                             | Сбой одного сервиса не влияет на другие                           | Дополнительная сложность архитектуры                           |
| **Другие полезные паттерны**       | Sidecar                               | Дополнительный контейнер рядом с сервисом                              | Логирование, мониторинг, прокси                                   | Усложняет деплой                                               |
|                                    | Adapter / Anti-Corruption Layer       | Слой для взаимодействия с внешними или устаревшими системами           | Защищает систему от "грязного" кода                               | Добавляет уровень абстракции                                   |
|                                    | Strangler Fig                         | Постепенная замена монолита микросервисами                             | Миграция без остановки системы                                    | Потребуется поддержка старой и новой системы одновременно      |


---

## Рекомендации по фреймворкам и технологиям

Python / Backend:

FastAPI — для микросервисов с REST/gRPC и асинхронностью.

Django + Django REST Framework — для более монолитных сервисов и стандартного CRUD.

SQLAlchemy / Tortoise ORM — для работы с базами данных.

Celery / Dramatiq — для асинхронной обработки задач.

Kafka / RabbitMQ — для event-driven архитектуры.

Orchestration / Workflow:

Temporal — надежная оркестрация длительных процессов.

Camunda — BPMN-движок для сложных бизнес-процессов.

Frontend / API Gateway:

GraphQL (Ariadne, Strawberry) — если нужен единый API для разных клиентов.

Nginx / Traefik — в роли API Gateway.

Dishka — лёгкий и современный Dependency Injection (DI) контейнер для Python.

BFF паттерн — можно использовать FastAPI или Node.js для отдельных шлюзов под каждый клиент.

---

# Руководство по разработке проекта


## 1. Введение
Цель: стандартизировать подход к разработке, поддерживаемость, масштабируемость и качество кода.  
Основа: *Дзен Пайтона* + мировые практики (Clean Code, SOLID, CI/CD, DevOps).

---

## 2. Принципы кодирования

### 2.1 Красота и читаемость
- **Красивое лучше, чем уродливое** — соблюдаем PEP8, линтеры (`flake8`, `pylint`), автоформатирование (`black`).  
- **Читаемость имеет значение** — осмысленные имена, простая структура кода.  

```python
# Плохо
def f(a,b): return a+b

# Хорошо
def add_numbers(first_number: int, second_number: int) -> int:
    """Возвращает сумму двух чисел"""
    return first_number + second_number
```

### 2.2 Ясность и простота
- **Явное лучше, чем неявное** — используем type hints.  
- **Простое лучше, чем сложное** — структура слоев: API → Сервис → Репозиторий.  
- **Плоское лучше, чем вложенное; разреженное лучше, чем плотное** — функции короткие и понятные.  

```python
# Плохо
if user.is_active:
    if user.has_permission('edit'):
        update_record(record)

# Хорошо
def can_edit(user):
    return user.is_active and user.has_permission('edit')

if can_edit(user):
    update_record(record)
```

---

## 3. Стандарты и согласованность
- **Особые случаи не должны ломать правила** — общие паттерны, без ad-hoc решений.  
- **Практичность важнее чистоты** — допустимы разумные компромиссы.  
- **Лучшие практики:** SOLID, DRY, KISS, Code Review.

### Примеры использования

#### SOLID
```python
# Принцип единственной ответственности (SRP)

# Плохо: один класс и валидирует данные, и сохраняет их
class UserHandler:
    def validate(self, data): ...
    def save(self, data): ...

# Хорошо: разделяем обязанности
class UserValidator:
    def validate(self, data): ...

class UserRepository:
    def save(self, data): ...
```

#### DRY
```python
# Плохо: дублирование кода

def calculate_rectangle_area(width, height):
    return width * height

def calculate_square_area(side):
    return side * side

# Хорошо: общая логика вынесена

def calculate_area(width, height):
    return width * height

def calculate_square_area(side):
    return calculate_area(side, side)
```

#### KISS
```python
# Плохо: чрезмерная сложность

def is_even(number):
    return True if number % 2 == 0 else False

# Хорошо: просто и понятно

def is_even(number):
    return number % 2 == 0
```

#### Code Review
- Каждый merge request проходит ревью минимум одним разработчиком.  
- Используем чек-листы: читаемость, тесты, архитектура.  
- Обсуждаем спорные решения, фиксируем договоренности в документации.

---

## 4. Обработка ошибок
- **Ошибки не должны проходить молча** — централизованная обработка и логирование.  
- **Если явно подавлены — допускается** — для ожидаемых ошибок.  

```python
try:
    process_data(data)
except ValidationError as e:
    logger.warning(f"Validation failed: {e}")
```

---

## 5. Архитектура и масштабируемость
- **При неоднозначности — не угадываем** — решения на основе анализа.  
- **Единый очевидный способ** — стандартизируем API, слои, методы.  
- **Namespaces — отличная идея** — пакеты, модули, микросервисы.  

### 5.1 Рекомендации по микросервисной архитектуре
- Разделяйте систему на логические сервисы с четкими границами ответственности.  
- Каждый микросервис должен быть автономным и развёртываться независимо.  
- Используйте API Gateway для маршрутизации запросов и единой точки входа.  
- Применяйте асинхронные очереди сообщений (RabbitMQ, Kafka) для взаимодействия между сервисами.  
- Документируйте контракт сервисов (OpenAPI/Swagger).  
- Автоматизируйте тестирование на уровне сервиса и интеграции.  
- Обеспечьте мониторинг и логирование каждого микросервиса.  
- Планируйте версионирование API для обратной совместимости.

**Рекомендации:**  
- Монолит на старте, постепенный переход на микросервисы.  
- CQRS и Event Sourcing для высоконагруженных систем.  
- Документируем архитектуру: C4 Model, диаграммы компонентов.

---

## 6. DevOps и автоматизация
- **Лучше сейчас, чем никогда** — CI/CD: автоматическое тестирование и деплой.  
- **Хотя никогда часто лучше, чем прямо сейчас** — постепенные изменения.  

**Инструменты:** Docker, Kubernetes, GitHub Actions/Jenkins, мониторинг, alerting.

---

## 7. Объяснимость и поддержка
- **Если сложно объяснить — плохая идея**  
- **Если легко объяснить — возможно, хорошая идея**  
- Документируем архитектуру, код и решения.  

**Инструменты:** MkDocs, Sphinx, Confluence

---

## 8. Тестирование и качество
- Unit и integration тесты обязательны, покрытие ≥ 80%.  
- TDD и BDD применяются для критических функций.  

```bash
pytest --cov=project tests/
```

---

## 9. Чек-лист для команды
- [ ] Код читаемый и PEP8 compliant  
- [ ] Логика проста и явна  
- [ ] Ошибки обрабатываются корректно  
- [ ] Архитектура соответствует стандартам  
- [ ] Документация и комментарии обновлены  
- [ ] Все тесты проходят, покрытие ≥ 80%  
- [ ] CI/CD pipeline настроен

---

## 10. Итог
Пишем код **Pythonic, ясный, поддерживаемый и масштабируемый**, соблюдая мировые стандарты разработки и принципы *Дзен Пайтона*.

---
